generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model MembershipTierConfig {
  id                    String   @id @default(cuid())
  name                  String   @unique
  slug                  String   @unique
  minSpent              Decimal  @db.Decimal(12, 2)
  maxSpent              Decimal? @db.Decimal(12, 2)
  discount              Decimal  @default(0) @db.Decimal(5, 4)
  pointsMultiplier      Decimal  @default(1.0) @db.Decimal(4, 2)
  freeShippingThreshold Decimal  @default(0) @db.Decimal(10, 2)
  birthdayGift          Decimal  @default(0) @db.Decimal(10, 2)
  sortOrder             Int      @default(0)
  color                 String?
  icon                  String?
  description           String?
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  users                 User[]

  @@index([isActive, sortOrder])
  @@index([slug])
  @@map("membership_tier_configs")
}

model User {
  id                     String                  @id @default(cuid())
  email                  String?                 @unique
  phone                  String?                 @unique
  password               String?
  name                   String
  role                   Role                    @default(USER)
  avatar                 String?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  lastLogin              DateTime?
  birthday               DateTime?
  emailVerifiedAt        DateTime?
  firstName              String?
  gender                 Gender?
  isActive               Boolean                 @default(true)
  isEmailVerified        Boolean                 @default(false)
  isPhoneVerified        Boolean                 @default(false)
  lastName               String?
  membershipExpiredAt    DateTime?
  membershipPoints       Int                     @default(0)
  phoneVerifiedAt        DateTime?
  preferences            Json                    @default("{}")
  totalOrders            Int                     @default(0)
  totalSpent             Decimal                 @default(0) @db.Decimal(12, 2)
  isFirstTimeBuyer       Boolean                 @default(true)
  firstPurchaseAt        DateTime?
  lineId                 String?                 @unique
  lineDisplayName        String?
  lineProfileImage       String?
  isLineConnected        Boolean                 @default(false)
  isLineOfficialFriend   Boolean                 @default(false)
  lineConnectedAt        DateTime?
  membershipTierId       String?
  marketingEmailOptIn    Boolean                 @default(false)
  marketingEmailOptInAt  DateTime?
  unsubscribeToken       String?                 @unique
  addresses              Address[]
  campaignOrders         CampaignOrder[]
  campaignParticipations CampaignParticipation[]
  campaignRewards        CampaignReward[]
  cartItems              CartItem[]
  cart                   Cart?
  conversations          Conversation[]
  emailLogs              EmailLog[]
  notifications          Notification[]
  orders                 Order[]
  pointTransactions      PointTransaction[]
  referralCodes          ReferralCode[]          @relation("ReferralCodeOwner")
  referralsAsReferee     ReferralUsage[]         @relation("ReferralReferee")
  referralsAsReferrer    ReferralUsage[]         @relation("ReferralReferrer")
  reviews                Review[]
  userCoupons            UserCoupon[]
  credits                UserCredit[]
  membershipTierConfig   MembershipTierConfig?   @relation(fields: [membershipTierId], references: [id])
  wishlistItems          WishlistItem[]

  @@index([email])
  @@index([phone])
  @@index([lineId])
  @@index([membershipTierId])
  @@index([marketingEmailOptIn])
  @@index([isActive, role])
  @@index([totalSpent])
  @@index([createdAt])
  @@index([isActive, createdAt])
  @@map("users")
}

model OtpVerification {
  id        String     @id @default(cuid())
  phone     String
  code      String
  purpose   OtpPurpose
  expiresAt DateTime
  isUsed    Boolean    @default(false)
  usedAt    DateTime?
  attempts  Int        @default(0)
  createdAt DateTime   @default(now())

  @@index([phone, purpose, expiresAt])
  @@map("otp_verifications")
}

model Address {
  id        String   @id @default(cuid())
  userId    String
  name      String
  phone     String
  country   String   @default("台灣")
  city      String
  district  String
  street    String
  zipCode   String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders    Order[]

  @@map("addresses")
}

model Category {
  id              String           @id @default(cuid())
  name            String           @unique
  slug            String           @unique
  image           String?
  sortOrder       Int              @default(0)
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  categoryDisplay CategoryDisplay?
  products        Product[]

  @@map("categories")
}

model Brand {
  id         String    @id @default(cuid())
  name       String    @unique
  slug       String    @unique
  logo       String?
  website    String?
  country    String?
  isActive   Boolean   @default(true)
  isFeatured Boolean   @default(false)
  sortOrder  Int       @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  products   Product[]

  @@map("brands")
}

model Product {
  id            String           @id @default(cuid())
  name          String
  slug          String           @unique
  description   String?
  price         Decimal          @db.Decimal(10, 2)
  originalPrice Decimal?         @db.Decimal(10, 2)
  cost          Decimal?         @db.Decimal(10, 2)
  stock         Int              @default(0)
  minStock      Int              @default(0)
  weight        Decimal?         @db.Decimal(8, 2)
  categoryId    String
  brandId       String?
  images        Json             @default("[]")
  isActive      Boolean          @default(true)
  isFeatured    Boolean          @default(false)
  sortOrder     Int              @default(0)
  viewCount     Int              @default(0)
  soldCount     Int              @default(0)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  averageRating Decimal?         @db.Decimal(3, 2)
  reviewCount   Int              @default(0)
  favoriteCount Int              @default(0)
  shoeType      String?
  gender        ProductGender?
  season        String?
  heelHeight    Decimal?         @db.Decimal(5, 2)
  closure       String?
  sole          String?
  features      Json             @default("[]")
  // 購買數量限制設定
  maxQuantityPerOrder Int             @default(10) // 單筆訂單最多可購買數量
  maxCombinedQuantity Int             @default(3)  // 與其他產品搭配時的最大總數（適用於711物流）
  canCombinePackaging Boolean         @default(true) // 是否可以合併包裝（多雙裝一盒）
  packagingVolume     PackagingVolume @default(STANDARD) // 包裝體積大小
  minPackagingUnits   Int             @default(1) // 最小包裝單位（例如：1雙一盒）
  isNewArrival  Boolean          @default(false)
  bundleItems   BundleItem[]
  cartItems     CartItem[]
  orderItems    OrderItem[]
  variants      ProductVariant[]
  brand         Brand?           @relation(fields: [brandId], references: [id])
  category      Category         @relation(fields: [categoryId], references: [id])
  reviews       Review[]
  sizeCharts    SizeChart[]
  wishlistItems WishlistItem[]

  @@index([slug])
  @@index([isActive, categoryId])
  @@index([isActive, brandId])
  @@index([isActive, gender])
  @@index([isActive, price])
  @@index([isActive, createdAt])
  @@index([isActive, isFeatured])
  @@index([isActive, isNewArrival])
  @@index([categoryId, brandId, isActive])
  @@map("products")
}

model ProductVariant {
  id              String       @id @default(cuid())
  productId       String
  name            String
  barcode         String?
  attributes      Json
  color           String?
  colorHex        String?
  colorImage      String?
  material        String?
  pattern         String?
  priceAdjustment Decimal      @default(0) @db.Decimal(10, 2)
  stock           Int          @default(0)
  reservedStock   Int          @default(0)
  images          Json         @default("[]")
  weight          Decimal?     @db.Decimal(8, 2)
  isActive        Boolean      @default(true)
  isDefault       Boolean      @default(false)
  sortOrder       Int          @default(0)
  soldCount       Int          @default(0)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  bundleItems     BundleItem[]
  cartItems       CartItem[]
  orderItems      OrderItem[]
  product         Product      @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_variants")
}

model SizeChart {
  id         String     @id @default(cuid())
  productId  String
  variantId  String?
  eu         String
  us         String
  uk         String
  cm         String
  footLength Decimal    @db.Decimal(5, 2)
  footWidth  String?
  stock      Int        @default(0)
  isActive   Boolean    @default(true)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  cartItems  CartItem[]
  product    Product    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, variantId, eu])
  @@index([productId])
  @@index([stock])
  @@map("size_charts")
}

model Cart {
  id        String     @id @default(cuid())
  userId    String     @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  items     CartItem[]
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("carts")
}

model CartItem {
  id              String          @id @default(cuid())
  userId          String
  productId       String
  quantity        Int             @default(1)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  variantId       String?
  sizeEu          String?
  cartId          String
  price           Decimal         @db.Decimal(10, 2)
  sizeChartId     String?
  bundleId        String?
  isBundleItem    Boolean         @default(false)
  bundleItemPrice Decimal?        @db.Decimal(10, 2)
  suggestedBatch  Int?            // 建議的批次號（智能分單用）
  bundle          ProductBundle?  @relation(fields: [bundleId], references: [id])
  cart            Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product         Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  sizeChart       SizeChart?      @relation(fields: [sizeChartId], references: [id])
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  variant         ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([cartId, productId, variantId, sizeChartId])
  @@index([cartId])
  @@index([userId])
  @@index([productId])
  @@index([bundleId])
  @@index([cartId, productId, variantId, sizeChartId])
  @@index([userId, productId])
  @@map("cart_items")
}

model Order {
  id                     String          @id @default(cuid())
  orderNumber            String          @unique
  userId                 String?
  addressId              String?
  subtotal               Decimal         @db.Decimal(10, 2)
  shippingFee            Decimal         @default(0) @db.Decimal(10, 2)
  discount               Decimal         @default(0) @db.Decimal(10, 2)
  total                  Decimal         @db.Decimal(10, 2)
  status                 OrderStatus     @default(PENDING)
  paymentStatus          PaymentStatus   @default(PENDING)
  shippingStatus         ShippingStatus  @default(PENDING)
  paymentMethod          PaymentMethod?
  paymentId              String?
  paidAt                 DateTime?
  shippingMethod         String?
  trackingNumber         String?
  shippedAt              DateTime?
  deliveredAt            DateTime?
  couponId               String?
  notes                  String?
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  shippingName           String
  shippingPhone          String
  shippingCountry        String?         @default("台灣")
  shippingCity           String?
  shippingDistrict       String?         @default("")
  shippingStreet         String?
  shippingZipCode        String?         @default("")
  guestName              String?
  guestPhone             String?
  guestEmail             String?
  bankTransferImage      String?
  bankTransferNote       String?
  bankTransferVerifiedAt DateTime?
  pointsEarned           Int             @default(0)
  pointsUsed             Int             @default(0)
  cancelComment          String?
  cancelReason           String?
  cancelledAt            DateTime?
  // 包裝選項設定
  packagingOption        PackagingOption @default(STANDARD) // 包裝方式（標準/合併）
  packagingNote          String?         // 包裝備註
  batchGroupId           String?         // 分批訂單群組ID（當需要分批時）
  batchSequence          Int?            // 批次序號（第幾批）
  campaignOrders         CampaignOrder[]
  items                  OrderItem[]
  address                Address?        @relation(fields: [addressId], references: [id])
  coupon                 Coupon?         @relation(fields: [couponId], references: [id])
  user                   User?           @relation(fields: [userId], references: [id])
  payment                Payment?
  returns                Return[]

  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([shippingStatus])
  @@index([createdAt])
  @@index([orderNumber])
  @@index([userId, status])
  @@index([userId, createdAt])
  @@index([status, createdAt])
  @@index([status, paymentStatus])
  @@index([paymentMethod, status])
  @@index([paidAt])
  @@map("orders")
}

model OrderItem {
  id           String          @id @default(cuid())
  orderId      String
  productId    String
  productName  String
  productImage String?
  price        Decimal         @db.Decimal(10, 2)
  quantity     Int
  subtotal     Decimal         @db.Decimal(10, 2)
  createdAt    DateTime        @default(now())
  variantAttrs Json?
  variantId    String?
  variantName  String?
  sizeEu       String?
  color        String?
  order        Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product      Product         @relation(fields: [productId], references: [id])
  variant      ProductVariant? @relation(fields: [variantId], references: [id])
  returnItems  ReturnItem[]

  @@index([orderId])
  @@index([productId])
  @@index([productId, orderId])
  @@map("order_items")
}

model Payment {
  id                String             @id @default(cuid())
  orderId           String             @unique
  merchantOrderNo   String             @unique
  tradeNo           String?            @unique
  amount            Decimal            @db.Decimal(10, 2)
  paymentType       NewebPaymentType
  status            NewebPaymentStatus @default(PENDING)
  tradeInfo         String?
  tradeSha          String?
  responseData      Json?
  atmBankCode       String?
  atmVirtualAccount String?
  atmExpireDate     DateTime?
  cvsBankCode       String?
  cvsPaymentNo      String?
  cvsExpireDate     DateTime?
  card4No           String?
  card6No           String?
  authBank          String?
  respondCode       String?
  payTime           DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  errorMessage      String?
  errorCode         String?
  order             Order              @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([merchantOrderNo])
  @@index([tradeNo])
  @@index([status])
  @@index([paymentType])
  @@index([createdAt])
  @@map("payments")
}

model Coupon {
  id                   String           @id @default(cuid())
  code                 String           @unique
  name                 String
  description          String?
  type                 CouponType       @default(PERCENTAGE)
  value                Decimal          @db.Decimal(10, 2)
  minAmount            Decimal?         @db.Decimal(10, 2)
  maxDiscount          Decimal?         @db.Decimal(10, 2)
  usageLimit           Int?
  usedCount            Int              @default(0)
  userLimit            Int?
  isActive             Boolean          @default(true)
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  applicableCategories Json             @default("[]")
  applicableProducts   Json             @default("[]")
  excludeProducts      Json             @default("[]")
  isPublic             Boolean          @default(true)
  validFrom            DateTime
  validUntil           DateTime
  isLocked             Boolean          @default(false)
  campaignRewards      CampaignReward[]
  orders               Order[]
  userCoupons          UserCoupon[]

  @@index([code])
  @@index([isActive])
  @@index([validFrom, validUntil])
  @@map("coupons")
}

model UserCoupon {
  id           String    @id @default(cuid())
  userId       String
  couponId     String
  isUsed       Boolean   @default(false)
  usedAt       DateTime?
  orderId      String?
  obtainedFrom String?
  createdAt    DateTime  @default(now())
  expiresAt    DateTime?
  coupon       Coupon    @relation(fields: [couponId], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_coupons")
}

model Campaign {
  id                String                  @id @default(cuid())
  name              String
  slug              String                  @unique
  description       String?
  type              CampaignType            @default(PURCHASE_REWARD)
  rules             Json
  conditions        Json
  discountRules     Json
  startDate         DateTime
  endDate           DateTime
  maxParticipants   Int?
  maxUsagePerUser   Int?                    @default(1)
  maxDiscountAmount Decimal?                @db.Decimal(10, 2)
  minOrderAmount    Decimal?                @db.Decimal(10, 2)
  status            CampaignStatus          @default(DRAFT)
  priority          Int                     @default(0)
  isActive          Boolean                 @default(true)
  isPublic          Boolean                 @default(true)
  bannerImage       String?
  thumbnailImage    String?
  participantCount  Int                     @default(0)
  completedCount    Int                     @default(0)
  totalRevenue      Decimal                 @default(0) @db.Decimal(12, 2)
  totalDiscount     Decimal                 @default(0) @db.Decimal(12, 2)
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  orders            CampaignOrder[]
  participations    CampaignParticipation[]
  rewards_given     CampaignReward[]

  @@index([slug])
  @@index([type])
  @@index([status])
  @@index([isActive])
  @@index([startDate, endDate])
  @@map("campaigns")
}

model CampaignParticipation {
  id             String              @id @default(cuid())
  campaignId     String
  userId         String
  status         ParticipationStatus @default(REGISTERED)
  rewardsEarned  Json                @default("[]")
  rewardsStatus  RewardStatus        @default(PENDING)
  participatedAt DateTime            @default(now())
  completedAt    DateTime?
  campaign       Campaign            @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user           User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([campaignId, userId])
  @@map("campaign_participations")
}

model CampaignReward {
  id          String       @id @default(cuid())
  campaignId  String
  userId      String
  rewardType  RewardType
  rewardValue Decimal?     @db.Decimal(10, 2)
  couponId    String?
  productId   String?
  status      RewardStatus @default(PENDING)
  earnedAt    DateTime     @default(now())
  grantedAt   DateTime?
  expiresAt   DateTime?
  campaign    Campaign     @relation(fields: [campaignId], references: [id])
  coupon      Coupon?      @relation(fields: [couponId], references: [id])
  user        User         @relation(fields: [userId], references: [id])

  @@map("campaign_rewards")
}

model CampaignOrder {
  id             String   @id @default(cuid())
  campaignId     String
  orderId        String
  userId         String?
  discountAmount Decimal  @db.Decimal(10, 2)
  discountType   String
  originalPrice  Decimal  @db.Decimal(10, 2)
  finalPrice     Decimal  @db.Decimal(10, 2)
  appliedRules   Json     @default("[]")
  appliedAt      DateTime @default(now())
  campaign       Campaign @relation(fields: [campaignId], references: [id])
  order          Order    @relation(fields: [orderId], references: [id])
  user           User?    @relation(fields: [userId], references: [id])

  @@unique([campaignId, orderId])
  @@map("campaign_orders")
}

model UserCredit {
  id               String       @id @default(cuid())
  userId           String
  amount           Decimal      @db.Decimal(10, 2)
  balance          Decimal      @db.Decimal(10, 2)
  source           CreditSource @default(CAMPAIGN)
  sourceId         String?
  maxUsagePerOrder Decimal?     @db.Decimal(10, 2)
  minOrderAmount   Decimal?     @db.Decimal(10, 2)
  validFrom        DateTime     @default(now())
  validUntil       DateTime
  isActive         Boolean      @default(true)
  isUsed           Boolean      @default(false)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_credits")
}

model ReferralSettings {
  id                   String   @id @default(cuid())
  isEnabled            Boolean  @default(true)
  rewardAmount         Decimal  @default(100) @db.Decimal(10, 2)
  minOrderAmount       Decimal  @default(0) @db.Decimal(10, 2)
  maxRewardsPerReferee Int      @default(0)
  rewardType           String   @default("FIXED")
  rewardPercentage     Decimal  @default(0) @db.Decimal(5, 2)
  maxRewardPerOrder    Decimal? @db.Decimal(10, 2)
  creditValidityDays   Int      @default(365)
  description          String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("referral_settings")
}

model ReferralCode {
  id           String          @id @default(cuid())
  userId       String
  code         String          @unique
  usedCount    Int             @default(0)
  isActive     Boolean         @default(true)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  totalRewards Decimal         @default(0) @db.Decimal(10, 2)
  user         User            @relation("ReferralCodeOwner", fields: [userId], references: [id], onDelete: Cascade)
  usages       ReferralUsage[]

  @@index([userId])
  @@index([code])
  @@map("referral_codes")
}

model ReferralUsage {
  id             String       @id @default(cuid())
  referralCodeId String
  referrerId     String
  refereeId      String
  rewardGranted  Boolean      @default(false)
  creditId       String?
  createdAt      DateTime     @default(now())
  orderId        String?
  orderAmount    Decimal?     @db.Decimal(10, 2)
  rewardAmount   Decimal      @default(0) @db.Decimal(10, 2)
  referee        User         @relation("ReferralReferee", fields: [refereeId], references: [id], onDelete: Cascade)
  referralCode   ReferralCode @relation(fields: [referralCodeId], references: [id], onDelete: Cascade)
  referrer       User         @relation("ReferralReferrer", fields: [referrerId], references: [id], onDelete: Cascade)

  @@index([referralCodeId])
  @@index([referrerId])
  @@index([refereeId])
  @@index([orderId])
  @@map("referral_usages")
}

model Conversation {
  id            String             @id @default(cuid())
  userId        String
  subject       String?
  status        ConversationStatus @default(OPEN)
  lastMessageAt DateTime           @default(now())
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  user          User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages      Message[]

  @@index([userId])
  @@index([status])
  @@map("conversations")
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String
  senderType     SenderType
  content        String
  isRead         Boolean      @default(false)
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderId])
  @@map("messages")
}

model Return {
  id                String       @id @default(cuid())
  returnNumber      String       @unique
  orderId           String
  type              ReturnType   @default(RETURN)
  reason            ReturnReason @default(DEFECTIVE)
  description       String?
  images            Json         @default("[]")
  refundAmount      Decimal      @db.Decimal(10, 2)
  refundMethod      String?
  refundStatus      RefundStatus @default(PENDING)
  refundedAt        DateTime?
  returnShippingFee Decimal      @default(0) @db.Decimal(10, 2)
  trackingNumber    String?
  status            ReturnStatus @default(REQUESTED)
  processedBy       String?
  processedAt       DateTime?
  adminNotes        String?
  isSizeIssue       Boolean      @default(false)
  requestedSize     String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  items             ReturnItem[]
  order             Order        @relation(fields: [orderId], references: [id])

  @@map("returns")
}

model ReturnItem {
  id          String    @id @default(cuid())
  returnId    String
  orderItemId String
  quantity    Int
  reason      String?
  createdAt   DateTime  @default(now())
  orderItem   OrderItem @relation(fields: [orderItemId], references: [id])
  return      Return    @relation(fields: [returnId], references: [id], onDelete: Cascade)

  @@map("return_items")
}

model Faq {
  id           String   @id @default(cuid())
  question     String
  answer       String
  category     String?
  slug         String   @unique
  viewCount    Int      @default(0)
  helpfulCount Int      @default(0)
  isPublished  Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  sortOrder    Int      @default(0)

  @@index([isPublished, sortOrder])
  @@index([category])
  @@map("faqs")
}

model Review {
  id           String   @id @default(cuid())
  userId       String
  productId    String
  rating       Int
  title        String?
  content      String
  images       Json     @default("[]")
  orderId      String?
  verified     Boolean  @default(false)
  isApproved   Boolean  @default(false)
  isPublic     Boolean  @default(true)
  helpfulCount Int      @default(0)
  sizeFit      SizeFit?
  boughtSize   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [userId], references: [id])

  @@unique([userId, productId, orderId])
  @@index([productId])
  @@index([userId])
  @@index([rating])
  @@index([isApproved])
  @@index([createdAt])
  @@index([productId, isApproved, rating])
  @@index([userId, isApproved])
  @@map("reviews")
}

model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("wishlist_items")
}

model Notification {
  id         String           @id @default(cuid())
  userId     String
  type       NotificationType
  title      String
  message    String
  data       Json?
  isRead     Boolean          @default(false)
  isArchived Boolean          @default(false)
  relatedId  String?
  actionUrl  String?
  createdAt  DateTime         @default(now())
  expiresAt  DateTime?
  user       User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([type])
  @@index([createdAt])
  @@map("notifications")
}

model Announcement {
  id          String           @id @default(cuid())
  title       String
  content     String
  type        AnnouncementType @default(INFO)
  priority    Int              @default(0)
  isActive    Boolean          @default(true)
  startDate   DateTime         @default(now())
  endDate     DateTime?
  actionUrl   String?
  actionLabel String?
  createdBy   String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([isActive])
  @@index([startDate])
  @@index([priority])
  @@map("announcements")
}

model PointTransaction {
  id          String               @id @default(cuid())
  userId      String
  type        PointTransactionType
  amount      Int
  orderId     String?
  description String
  createdAt   DateTime             @default(now())
  user        User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("point_transactions")
}

model ProductBundle {
  id              String       @id @default(cuid())
  name            String
  slug            String       @unique
  description     String?
  originalPrice   Decimal      @db.Decimal(10, 2)
  bundlePrice     Decimal      @db.Decimal(10, 2)
  discount        Decimal?     @db.Decimal(10, 2)
  discountPercent Decimal?     @db.Decimal(5, 2)
  image           String?
  images          Json         @default("[]")
  isActive        Boolean      @default(true)
  isFeatured      Boolean      @default(false)
  showOnHomepage  Boolean      @default(true)
  sortOrder       Int          @default(0)
  startDate       DateTime?
  endDate         DateTime?
  maxPurchaseQty  Int?
  soldCount       Int          @default(0)
  viewCount       Int          @default(0)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  items           BundleItem[]
  cartItems       CartItem[]

  @@index([isActive, isFeatured])
  @@index([showOnHomepage, sortOrder])
  @@index([startDate, endDate])
  @@index([slug])
  @@map("product_bundles")
}

model BundleItem {
  id                    String          @id @default(cuid())
  bundleId              String
  productId             String
  quantity              Int             @default(1)
  variantId             String?
  allowVariantSelection Boolean         @default(true)
  sortOrder             Int             @default(0)
  createdAt             DateTime        @default(now())
  bundle                ProductBundle   @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  product               Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant               ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([bundleId])
  @@index([productId])
  @@map("bundle_items")
}

model HeroSlide {
  id             String       @id @default(cuid())
  title          String
  subtitle       String?
  description    String?
  cta            String
  link           String
  sortOrder      Int          @default(0)
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  bgColor        String?
  ctaSecondary   String?
  endDate        DateTime?
  linkSecondary  String?
  overlayOpacity Float        @default(0.3)
  startDate      DateTime?
  textColor      String       @default("#FFFFFF")
  textPosition   TextPosition @default(CENTER_LEFT)

  @@index([isActive, sortOrder])
  @@index([startDate, endDate])
  @@map("hero_slides")
}

model EmailCampaign {
  id              String              @id @default(cuid())
  name            String
  subject         String
  htmlContent     String
  textContent     String?
  status          EmailCampaignStatus @default(DRAFT)
  targetAudience  Json                @default("{}")
  scheduledAt     DateTime?
  sentAt          DateTime?
  totalRecipients Int                 @default(0)
  successCount    Int                 @default(0)
  failedCount     Int                 @default(0)
  openedCount     Int                 @default(0)
  clickedCount    Int                 @default(0)
  createdBy       String
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  emailLogs       EmailLog[]

  @@index([status])
  @@index([createdAt])
  @@map("email_campaigns")
}

model EmailLog {
  id           String         @id @default(cuid())
  campaignId   String
  userId       String
  email        String
  status       EmailLogStatus @default(PENDING)
  sentAt       DateTime?
  openedAt     DateTime?
  clickedAt    DateTime?
  bouncedAt    DateTime?
  errorMessage String?
  createdAt    DateTime       @default(now())
  campaign     EmailCampaign  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([userId])
  @@index([status])
  @@index([email])
  @@map("email_logs")
}

model HomepageConfig {
  id             String        @id @default(cuid())
  componentId    String        @unique
  componentType  ComponentType
  title          String?
  subtitle       String?
  isActive       Boolean       @default(true)
  sortOrder      Int           @default(0)
  settings       Json          @default("{}")
  mobileSettings Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@index([isActive, sortOrder])
  @@map("homepage_configs")
}

model SaleCountdown {
  id            String   @id @default(cuid())
  title         String
  subtitle      String?
  endTime       DateTime
  bgColor       String   @default("#FF0000")
  textColor     String   @default("#FFFFFF")
  link          String?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  description   String?
  highlightText String?

  @@index([isActive, endTime])
  @@map("sale_countdowns")
}

model GuaranteeItem {
  id          String   @id @default(cuid())
  icon        String
  title       String
  description String?
  link        String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive, sortOrder])
  @@map("guarantee_items")
}

model CategoryDisplay {
  id             String   @id @default(cuid())
  categoryId     String   @unique
  displayName    String?
  icon           String?
  image          String?
  bgColor        String?
  textColor      String?
  sortOrder      Int      @default(0)
  isHighlighted  Boolean  @default(false)
  showOnHomepage Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  category       Category @relation(fields: [categoryId], references: [id])

  @@index([showOnHomepage, sortOrder])
  @@map("category_displays")
}

model FlashSaleConfig {
  id          String   @id @default(cuid())
  name        String
  startTime   DateTime
  endTime     DateTime
  bgImage     String?
  bgColor     String   @default("#FF6B6B")
  products    Json
  maxProducts Int      @default(6)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive, startTime, endTime])
  @@map("flash_sale_configs")
}

model DailyDealConfig {
  id        String   @id @default(cuid())
  date      DateTime @unique
  title     String   @default("今日特價")
  subtitle  String?
  products  Json
  bgColor   String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive, date])
  @@map("daily_deal_configs")
}

model FloatingPromo {
  id        String            @id @default(cuid())
  type      FloatingPromoType @default(DISCOUNT)
  icon      String?
  text      String
  link      String
  bgColor   String            @default("#FF0000")
  textColor String            @default("#FFFFFF")
  position  FloatingPosition  @default(BOTTOM_RIGHT)
  animation String?
  startDate DateTime?
  endDate   DateTime?
  isActive  Boolean           @default(true)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  @@index([isActive, startDate, endDate])
  @@map("floating_promos")
}

model SuperDealSection {
  id          String     @id @default(cuid())
  title       String     @default("超值優惠")
  subtitle    String?
  bgImage     String?
  bgGradient  String?
  productIds  Json
  maxProducts Int        @default(8)
  layout      DealLayout @default(GRID)
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@map("super_deal_sections")
}

model PopularProductsConfig {
  id              String           @id @default(cuid())
  title           String           @default("熱門商品")
  subtitle        String?
  algorithm       PopularAlgorithm @default(MANUAL)
  productIds      Json?
  maxProducts     Int              @default(12)
  timeRange       Int?
  minSales        Int?
  showBadge       Boolean          @default(true)
  badgeText       String           @default("HOT")
  badgeColor      String           @default("#FF0000")
  autoRefresh     Boolean          @default(false)
  refreshInterval Int?
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@map("popular_products_configs")
}

enum ConversationStatus {
  OPEN
  CLOSED
  RESOLVED
}

enum SenderType {
  USER
  ADMIN
}

enum Role {
  USER
  ADMIN
}

enum OtpPurpose {
  REGISTER
  LOGIN
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum ProductGender {
  MEN
  WOMEN
  UNISEX
  KIDS
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  COMPLETED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  BANK_TRANSFER_PENDING
  BANK_TRANSFER_VERIFIED
}

enum PaymentMethod {
  BANK_TRANSFER
  LINE_PAY
  CREDIT_CARD
  CASH_ON_DELIVERY
  NEWEBPAY
}

enum NewebPaymentType {
  CREDIT_CARD
  VACC
  CVS
  BARCODE
  WEBATM
}

enum NewebPaymentStatus {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
  CANCELLED
  EXPIRED
  REFUNDED
}

enum ShippingStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
}

enum CampaignType {
  PURCHASE_REWARD
  FLASH_SALE
  BUNDLE_DEAL
  SEASONAL
  FIRST_TIME_BUYER
  BIRTHDAY_SPECIAL
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
  EXPIRED
}

enum CreditSource {
  CAMPAIGN
  REFUND
  ADMIN_GRANT
  BIRTHDAY
  REVIEW
}

enum ParticipationStatus {
  REGISTERED
  IN_PROGRESS
  COMPLETED
  FAILED
}

enum RewardStatus {
  PENDING
  PROCESSING
  GRANTED
  FAILED
  EXPIRED
}

enum RewardType {
  CREDITS
  COUPON
  PRODUCT
  DISCOUNT
  FREE_SHIPPING
  MEMBERSHIP_POINTS
}

enum CouponType {
  PERCENTAGE
  FIXED
  FREE_SHIPPING
  BUY_X_GET_Y
}

enum ReturnType {
  RETURN
  EXCHANGE
  REPAIR
}

enum ReturnReason {
  DEFECTIVE
  WRONG_ITEM
  SIZE_ISSUE
  NOT_AS_DESCRIBED
  DAMAGED_SHIPPING
  CHANGED_MIND
  OTHER
}

enum ReturnStatus {
  REQUESTED
  APPROVED
  REJECTED
  RECEIVED
  PROCESSING
  COMPLETED
  CANCELLED
}

enum RefundStatus {
  PENDING
  APPROVED
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum NotificationType {
  ORDER_CONFIRMED
  ORDER_SHIPPED
  ORDER_DELIVERED
  PAYMENT_SUCCESS
  PAYMENT_FAILED
  PRODUCT_BACK_IN_STOCK
  PRICE_DROP
  PROMOTION
  ACCOUNT_UPDATE
  SYSTEM_MAINTENANCE
  GENERAL
}

enum PointTransactionType {
  FIRST_PURCHASE_BONUS
  ORDER_REWARD
  REFUND
  ADMIN_ADJUSTMENT
  CAMPAIGN_REWARD
}

enum SizeFit {
  TOO_SMALL
  SLIGHTLY_SMALL
  TRUE_TO_SIZE
  SLIGHTLY_LARGE
  TOO_LARGE
}

enum AnnouncementType {
  INFO
  SUCCESS
  WARNING
  ERROR
  PROMOTION
  MAINTENANCE
}

enum ComponentType {
  HERO_SLIDER
  SALE_COUNTDOWN
  GUARANTEE_BAR
  FLASH_SALE
  CATEGORY_GRID
  DAILY_DEALS
  SUPER_DEALS
  POPULAR_PRODUCTS
  NEW_ARRIVALS
  FEATURED_BRANDS
  CUSTOMER_REVIEWS
  NEWSLETTER
  CUSTOM_BANNER
  CUSTOM_HTML
}

enum TextPosition {
  TOP_LEFT
  TOP_CENTER
  TOP_RIGHT
  CENTER_LEFT
  CENTER
  CENTER_RIGHT
  BOTTOM_LEFT
  BOTTOM_CENTER
  BOTTOM_RIGHT
}

enum FloatingPromoType {
  DISCOUNT
  GIFT
  CUSTOMER_SERVICE
  CART
  CUSTOM
}

enum FloatingPosition {
  TOP_LEFT
  TOP_RIGHT
  BOTTOM_LEFT
  BOTTOM_RIGHT
  CENTER_LEFT
  CENTER_RIGHT
}

enum DealLayout {
  GRID
  CAROUSEL
  LIST
  MASONRY
}

enum PopularAlgorithm {
  MANUAL
  SALES_VOLUME
  VIEW_COUNT
  RATING
  TRENDING
}

enum EmailCampaignStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  FAILED
  CANCELLED
}

enum EmailLogStatus {
  PENDING
  SENDING
  SENT
  OPENED
  CLICKED
  BOUNCED
  FAILED
}

enum PackagingVolume {
  SMALL    // 小型包裝（如單雙運動鞋、涼鞋）
  STANDARD // 標準包裝（如一般鞋款）
  LARGE    // 大型包裝（如靴子、高筒鞋）
  OVERSIZED // 超大包裝（特殊款式）
}

enum PackagingOption {
  STANDARD // 標準包裝（每雙獨立包裝）
  COMBINED // 合併包裝（多雙裝一盒，減少體積）
  SEPARATE // 強制分開包裝（客戶要求）
}
